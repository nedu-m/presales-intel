{% extends "base.html" %}

{% block title %}{{ brief.company_name }} - Presales Intel{% endblock %}

{% block content %}
<div class="page-actions">
    <a href="/briefs/history" class="secondary-btn">Back to history</a>
</div>

<section class="surface-panel brief-card" id="detail-brief">
    <div class="panel-header">
        <div>
            <h1 style="margin: 0; font-size: 2.4rem;">{{ brief.company_name }}</h1>
            <p style="margin: 0.5rem 0 0; color: var(--muted); font-size: 0.95rem;">
                Generated {{ brief.created_at.strftime('%B %d, %Y at %I:%M %p') }}
            </p>
        </div>
        <div class="panel-actions" style="justify-content: flex-start;">
            <button type="button" class="secondary-btn" onclick="window.print()">Print brief</button>
            <button type="button" class="secondary-btn" onclick="copyDetailBrief()">Copy text</button>
            <a href="/" class="primary-btn" style="padding: 0.85rem 1.5rem;">Generate another</a>
        </div>
    </div>

    {% if brief.attendees %}
    <div class="detail-meta">
        <strong>Meeting attendees:</strong> {{ brief.attendees }}
    </div>
    {% endif %}

    {% set sections = [
        ("Company context", brief.company_context),
        ("Attendee analysis", brief.attendee_analysis),
        ("Tech & security", brief.tech_stack),
        ("Competitive landscape", brief.competitive_landscape),
        ("Questions & talking points", brief.suggested_questions)
    ] %}
    <div class="section-grid">
        {% for label, content in sections %}
            {% if content %}
            <article class="section-card">
                <small>{{ label }}</small>
                <p>{{ content|striptags|replace('\n', ' ')|truncate(200, False, 'â€¦') }}</p>
            </article>
            {% endif %}
        {% endfor %}
    </div>

    <div class="markdown-content">
        {{ brief.full_brief|markdown|safe }}
    </div>
</section>

<script>
function copyDetailBrief() {
    const section = document.querySelector('#detail-brief .markdown-content');
    if (!section) return;
    navigator.clipboard.writeText(section.innerText).then(() => {
        console.log('Brief copied to clipboard');
    });
}
</script>
{% endblock %}
